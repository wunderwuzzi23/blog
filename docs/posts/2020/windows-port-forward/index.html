<!DOCTYPE html>
<html lang="en-us">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <meta property="og:title" content=" portproxy - Performing port-proxing on Windows &middot;  wunderwuzzi blog" />
  
  <meta property="og:site_name" content="wunderwuzzi blog" />
  <meta property="og:url" content="https://embracethered.com/blog/posts/2020/windows-port-forward/" />
  
  
  <meta property="og:type" content="article" />
  
  <meta property="og:article:published_time" content="2020-07-14T20:18:51-07:00" />
  
  <meta property="og:article:tag" content="red" />
  
  <meta property="og:article:tag" content="ttp" />
  
  <meta property="og:article:tag" content="windows" />
  
  

  <title>
     portproxy - Performing port-proxing on Windows &middot;  wunderwuzzi blog
  </title>

  <link rel="stylesheet" href="https://embracethered.com/blog/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/main.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/github.css" />
  
  <link rel="stylesheet" href="https://embracethered.com/blog/fonts/cachedfonts.css" type="text/css">
  <link rel="shortcut icon" href="https://embracethered.com/blog/images/favicon.ico" />
  <link rel="apple-touch-icon" href="https://embracethered.com/blog/images/apple-touch-icon.png" />
  

</head>
<body>
    <header class="global-header"  style="background-image:url( /images/bg.jpg )">
    <section class="header-text">
      <h1><a href="https://embracethered.com/blog/">wunderwuzzi blog</a></h1>
      
      <div class="tag-line" style="min-width:fit-content; font-weight: 400;">
        Embrace the Red
        <br><a style="color: greenyellow; font-weight:300;text-decoration: underline; " href="https://www.amazon.com/Cybersecurity-Attacks-Strategies-practical-penetration-ebook/dp/B0822G9PTM">Cybersecurity Attacks - Red Team Strategies</a> 
      </div>
      
      <div class="sns-links hidden-print">
  
  <a href="mailto:security@wunderwuzzi.net">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  <a href="https://twitter.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  
  <a href="https://github.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
  
  
  
  <a href="/blog/index.xml" target="_blank">
    <i class="fa fa-rss"></i>
  </a>
</div>

      
      <a href="https://embracethered.com/blog/" class="btn-header btn-back hidden-xs">
        <i class="fa fa-angle-left" aria-hidden="true"></i>
        &nbsp;Home
      </a>
      
      
      <a href="/blog/index.xml" class="btn-header btn-subscribe hidden-xs">
        <i class="fa fa-rss" aria-hidden="true"></i>
        &nbsp;Subscribe
      </a>
    </section>
  </header>
  <main class="container">


<article>
  <header>
    <h1 class="text-primary">portproxy - Performing port-proxing on Windows</h1>
    <div class="post-meta clearfix">
    
      <div class="post-date pull-left">
        Posted on
        <time datetime="2020-07-14T20:18:51-07:00">
          Jul 14, 2020
        </time>
      </div>
    
      <div class="pull-right">
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/red">#red</a></span>
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/ttp">#ttp</a></span>
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/windows">#windows</a></span>
        
      </div>
    </div>
  </header>
  <section>
    

<p>A technique on Windows that is less known is how to do basic port-proxing and port-forwarding.</p>

<p>When is this useful?</p>

<blockquote>
<p>Proxing traffic is useful when a process binds on one (maybe the local) interface and you want to expose the traffic on another network interface.</p>
</blockquote>

<p>Let&rsquo;s say you have a process that  binds on the loopback interface, but you want to expose it remotely. Or another example is to that there are two network interfaces and you want to expose an endpoint on one interface on the other - think of basic pivoting techniques between networks.</p>

<p>I remember it took me quite a while to figure how to do this on Windows the first time I needed this. If you know Linux, you probably are familiar with the power of <code>ssh</code> and it&rsquo;s range of command line options. The good news is that Windows 10 ships with <code>ssh</code> - but this post is not about ssh.</p>

<p>In this post we will look at built-in Windows tools such as <code>netsh</code> and <code>portproxy</code> that can be used.</p>

<p>In Windows this can be done by an Administrator using:</p>

<p><code>netsh interface portproxy</code></p>

<p>The following command shows how this is performed:</p>

<p><code>netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=48333 connectaddress=127.0.0.1 connectport=3389</code></p>

<p>This is the basic setup to configure proxing traffic. Although, remote connections to port 48333 will not be allowed because the firewall blocks them.</p>

<p>We have to add a new firewall rule to allow <code>port 48333</code>.</p>

<p>How does that work on Windows you might ask?</p>

<h2 id="allowing-traffic-through-the-firewall">Allowing traffic through the firewall</h2>

<p>There are multiple ways to update firewall rules in Windows. Besides the UI the following commands might come in handy:</p>

<ol>
<li>Use netsh to add a new firewall rule:
<code>netsh advfirewall firewall add rule name=&quot;Open Port 48333&quot; dir=in action=allow protocol=TCP localport=48333</code></li>

<li><p>On modern Windows machines, this can also be done via PowerShell commands:</p>

<p><code>New-NetFirewallRule -Name FirefoxRemote -DisplayName &quot;Open Port 48333&quot; -Direction Inbound -Protocol tcp -LocalPort 48333 -Action Allow -Enabled True</code></p></li>
</ol>

<p>Now, it is all setup to connect to from another machine to port 48333.</p>

<p>It also works between IPv4 and IPv6. Very cool. :)</p>

<h2 id="cleaning-up-and-reverting-changes">Cleaning up and reverting changes</h2>

<p>In order to remove port forwarding and revert to the defaults, we can run the following commands:</p>

<p><code>netsh interface portproxy reset</code></p>

<p>Alternatively, there is a delete argument.</p>

<p>The same applies for opening port 48333 on the machine. The firewall rule can be removed again using the following command:</p>

<p><code>netsh advfirewall firewall del rule name=&quot;Open Port 48333&quot;</code></p>

<p>or if you like PowerShell:</p>

<p><code>Remove-NetFirewallRule -Name FirefoxRemote</code></p>

<p>That&rsquo;s it.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In this post we explored some simple commands to expose ports (proxy/forward them) on different network interfaces. Hope the post was informative and useful.</p>

<p>Feel free to follow or message me on Twitter <a href="https://twitter.com/wunderwuzzi23">@wunderwuzzi23</a>.</p>

<h2 id="references">References</h2>

<p>The detailed documentation for <code>netsh interface portproxy</code> can be found here:
<a href="https://docs.microsoft.com/en-us/windows-server/networking/technologies/netsh/netsh-interface-portproxy">https://docs.microsoft.com/en-us/windows-server/networking/technologies/netsh/netsh-interface-portproxy</a></p>

  </section>
  <footer>
    
    
    
    <footer></footer><hr/>
    
    <ul class="pager">
      
      <li class="previous"><a href="https://embracethered.com/blog/posts/2020/aws-xss-cross-site-scripting-vulnerability/"><span aria-hidden="true">&larr;</span> Older</a></li>
      
      
      <li class="author-contact">
        <a href="mailto:security@wunderwuzzi.net">
          <i class="fa fa-envelope-o" aria-hidden="true"></i>
          &nbsp;Contact me
        </a>
     </li>

      
      
      <li class="next disabled"><a href="#">Newer <span aria-hidden="true">&rarr;</span></a></li>
      
    </ul>
  </footer>
</article>
</main>
  <footer class="container global-footer">
    <div class="copyright-note pull-left">
     
     (c) WUNDERWUZZI 2020
     <div class="sns-links hidden-print">
  
  <a href="mailto:security@wunderwuzzi.net">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  <a href="https://twitter.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  
  <a href="https://github.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
  
  
  
  <a href="/blog/index.xml" target="_blank">
    <i class="fa fa-rss"></i>
  </a>
</div>
 
     <div style="font-size:small;font-style: italic;color:crimson">
    Disclaimer: Penetration testing requires authorization from proper stakeholders. Information on this blog is provided for research and educational purposes to advance understanding of attacks and countermeasures to help secure the Internet. 
    </div>
    </div>
</footer>
  <script src="https://embracethered.com/blog/js/highlight.pack.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  
  



<script type="text/javascript">
  var _paq = window._paq || [];
  _paq.push(["disableCookies"]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//wuzzi.net/anamato/inc/";
    _paq.push(['setTrackerUrl', u+'rts.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'rts.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<img src="https://wuzzi.net/anamato/inc/rts.php?idsite=1&amp;rec=1" style="border:0;" alt="" />
  
</body>
</html>

