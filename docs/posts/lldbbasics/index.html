<!DOCTYPE html>
<html lang="en-us">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <meta name="description" content="Understand basic LLDB commands and usage" />
  <link rel="canonical" href="https://embracethered.com/blog/posts/lldbbasics/" />
  <meta property="og:title" content=" McPivot and useful LLDB commands &middot;  Embrace The Red" />
  <meta property="og:description" content="Understand basic LLDB commands and usage" />
  <meta property="og:site_name" content="Embrace The Red" />
  <meta property="og:url" content="https://embracethered.com/blog/posts/lldbbasics/" />
  <meta property="og:type" content="article" />
  <meta property="og:article:published_time" content="2019-01-05T21:34:51-07:00" />
  <meta property="og:article:tag" content="pentesting" />
  <meta property="og:article:tag" content="red" />
  <meta property="og:article:tag" content="TTP" />

  <title>
     McPivot and useful LLDB commands &middot;  Embrace The Red
  </title>

  <link rel="stylesheet" href="https://embracethered.com/blog/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/main.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/github.css" />
  
  <link rel="stylesheet" href="https://embracethered.com/blog/fonts/cachedfonts.css" type="text/css">
  <link rel="shortcut icon" type="image/x-icon" href="https://embracethered.com/blog/images/favicon.ico" />
  <link rel="apple-touch-icon" type="image/x-icon" href="https://embracethered.com/blog/images/favicon.ico" />

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "\"McPivot and useful LLDB commands\"",
    "description": "\"Understand basic LLDB commands and usage\"",
    "author": {
      "@type": "Person",
      "name": "wunderwuzzi",
      "url": "https://x.com/wunderwuzzi23"
    },
    "publisher": {
      "@type": "Organization",
      "name": "\"Embrace The Red\"",
      "logo": {
        "@type": "ImageObject",
        "url": "https:\/\/embracethered.com\/blog\/images/favicon.ico"
      }
    },
    "url": "\"https://embracethered.com/blog/posts/lldbbasics/\"",
    "datePublished": "\"2019-01-05T21:34:51-07:00\"","dateModified": "\"2019-01-05T21:34:51-07:00\"",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "\"https://embracethered.com/blog/posts/lldbbasics/\""
    }
  }
  </script>

</head>
<body>
    <header class="global-header"  style="background-image:url( /blog/images/bg.png )">
    <section class="header-text">
      <h1><a href="https://embracethered.com/blog/">Embrace The Red</a></h1>
      
      <div class="tag-line" style="min-width:fit-content; font-weight: 400;">
        wunderwuzzi&#39;s blog
        <br><div style="color: greenyellow; font-weight:400;">learn the hacks, stop the attacks.</div> 
      </div>
      
      <div class="sns-links hidden-print">
  
  <a href="mailto:security@wunderwuzzi.net">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  <a href="https://twitter.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  
  <a href="https://github.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
  
  <a href="https://youtube.com/@embracethered" target="_blank">
    <i class="fa fa-youtube"></i>
  </a>
  
  
  
  <a href="/blog/index.xml" target="_blank">
    <i class="fa fa-rss"></i>
  </a>
</div>

      
      <a href="https://embracethered.com/blog/" class="btn-header btn-back hidden-xs">
        <i class="fa fa-angle-left" aria-hidden="true"></i>
        &nbsp;Home
      </a>
      
    
      <a href="/blog/index.xml" class="btn-header btn-rss hidden-xs">
        <i class="fa fa-rss" aria-hidden="true"></i>
        &nbsp;RSS
      </a>
      <a data-formkit-toggle="15376e9e24" href="https://embracethered.kit.com/15376e9e24" class="btn-header btn-subscribe hidden-xs">
        <i class="fa fa-envelope" aria-hidden="true"></i>
        &nbsp;Subscribe
      </a>
    </section>
  </header>
  
  <button data-formkit-toggle="15376e9e24" class="fab-subscribe" aria-label="Subscribe to newsletter">
    <i class="fa fa-envelope"></i>
  </button>
  <main class="container">


<article>
  <header>
    <h1 class="text-primary">McPivot and useful LLDB commands</h1>
    <div class="post-meta clearfix">
    
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-01-05T21:34:51-07:00">
          Jan 5, 2019
        </time>
      </div>
    
      <div class="pull-right">
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/pentesting">#pentesting</a></span>
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/red">#red</a></span>
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/ttp">#TTP</a></span>
        
      </div>
    </div>
  </header>
  <section>
    <p>Just a list of useful notes when dealing with Macs. I&rsquo;m pretty new to Macs and there might be other, better solutions to the challenges I had to sovle but these worked for me and I&rsquo;m learning. :)</p>
<h2 id="pivoting-between-accounts-and-keychain-issues">Pivoting between accounts and keychain issues</h2>
<p>After pivoting on a target host and elevating to root it seems not possible to gain access to other keychains easily. It requires to know the password of the other account still. Just running</p>
<pre><code>security dump-keychain 
</code></pre>
<p>doesn&rsquo;t work over ssh even after su - which kinda makes sense.</p>
<p>It also doesn&rsquo;t work when authenticating via public/private key pair as some articles I read suggested - which also makes sense since the keychain is encrypted using the users password afaik.</p>
<p>One still has to run</p>
<pre><code>security unlock-keychain -i 
</code></pre>
<p>and enter the password for it to work. It seems that keychain just isn&rsquo;t unlocked over ssh.</p>
<p>Overall, this is actually pretty neat and a good defense in depth feature, which as I&rsquo;m learning MacOS has quite a bit. Setting that aside there are a couple of pivoting things I explored and tried out and I&rsquo;m posting this for my future reference. :)</p>
<h2 id="pivoting">Pivoting</h2>
<ol>
<li>Updating ~/.bash_profile to wait for the target to open a new terminal.</li>
<li>Pivot over to a process of the target and inject code into a running process.</li>
</ol>
<h2 id="inject-code-into-another-running-process">Inject code into another running process</h2>
<p>SIP (System Integrety Protection) makes it difficult to debug other process, even as root.</p>
<p>Turning it off requires at least a reboot and some hands on work on the machine. The good news is, that its typically not that difficult to find some binaries that aren&rsquo;t protected. Haven&rsquo;t figured out yet exactly what makes a binary (it&rsquo;s some mix of entitlement and signature I think).</p>
<p>So, you can&rsquo;t debug the Google Chrome process, but you might find something else that is running that you can debug.</p>
<h2 id="attach">Attach</h2>
<pre><code>lldb -n processname
lldb -p pid
</code></pre>
<h2 id="expressions-and-the-mcpivot">Expressions and the McPivot</h2>
<p>Time to learn about lldb, which I have never used before. Turns out that with expressions one can inject and run code the debugged process.</p>
<p>That&rsquo;s straight forward and super simple.</p>
<pre><code>p (void) system(&quot;whoami &amp;&gt; /tmp/log.txt&quot;)
</code></pre>
<p>This stackoverflow post here gave me the basic inspiration.</p>
<h2 id="final-notes">Final Notes</h2>
<p>Last but not least, there is a difference in regards to keychain access when pivoting into an existing session of a user (e.g. the discussed profile/debugger pivot vs. just ssh) that was observerved.</p>
<p>I might be lacking the right terminology at this point (not knowing MacOS architecture that well), I&rsquo;d say that they keyhain (login keychain) is unlocked already in the session pivot case. While when doing an SSH session the keychain is still locked, and it can be unlocked with security unlock-keychain -i.</p>
<p>Regardless however, the user still(!) has to enter the password when trying to access the sensitive parts of the keychain. That&rsquo;s my take on this - there is more I learned when exfiltrating Chrome cookies and I will write about this soon.</p>

  </section>
  <footer>
    
    
    
    <footer></footer><hr/>
    
    <ul class="pager">
      
      <li class="next"><a href="https://embracethered.com/blog/posts/koiphish/">Newer <span aria-hidden="true">&rarr;</span></a></li>
      
      
      <li class="author-contact">
        <a href="mailto:security@wunderwuzzi.net">
          <i class="fa fa-envelope-o" aria-hidden="true"></i>
          &nbsp;Contact me
        </a>
     </li>

      
      
      <li class="previous"><a href="https://embracethered.com/blog/posts/passthecookie/"><span aria-hidden="true">&larr;</span> Older</a></li>
      
    </ul>
  </footer>
</article>
</main>
  <footer class="container global-footer">
    <div class="copyright-note pull-left">
     
     (c) WUNDERWUZZI 2018-2026
     <div class="sns-links hidden-print">
  
  <a href="mailto:security@wunderwuzzi.net">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  <a href="https://twitter.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  
  <a href="https://github.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
  
  <a href="https://youtube.com/@embracethered" target="_blank">
    <i class="fa fa-youtube"></i>
  </a>
  
  
  
  <a href="/blog/index.xml" target="_blank">
    <i class="fa fa-rss"></i>
  </a>
</div>
 
     <div style="font-size:small;font-style: italic;color:crimson">
    Disclaimer: Penetration testing requires authorization from proper stakeholders. Information on this blog is provided for research and educational purposes to advance understanding of attacks and countermeasures to help secure the Internet. | <a href="https://embracethered.com/blog/privacy.txt">Privacy</a>
    </div>
    </div>
</footer>
  <script src="https://embracethered.com/blog/js/highlight.pack.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  
  



<script type="text/javascript">
  var _paq = window._paq || [];
  _paq.push(["disableCookies"]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//wuzzi.net/anamato/inc/";
    _paq.push(['setTrackerUrl', u+'rts.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'rts.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<img src="https://wuzzi.net/anamato/inc/rts.php?idsite=1&amp;rec=1" style="border:0;" alt="" />


<div class="kit-subscribe-wrapper">
  <script async data-uid="15376e9e24" src="https://embracethered.kit.com/15376e9e24/index.js"></script>
</div>

</body>
</html>

