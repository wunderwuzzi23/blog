<!DOCTYPE html>
<html lang="en-us">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <meta property="og:title" content=" Cross-Agent Privilege Escalation: When Agents Free Each Other &middot;  Embrace The Red" />
  
  <meta property="og:site_name" content="Embrace The Red" />
  <meta property="og:url" content="https://embracethered.com/blog/posts/2025/cross-agent-privilege-escalation-agents-that-free-each-other/" />
  
  
  <meta property="og:type" content="article" />
  
  <meta property="og:article:published_time" content="2025-09-24T12:20:58-07:00" />
  
  <meta property="og:article:tag" content="llm" />
  
  <meta property="og:article:tag" content="agents" />
  
  

  <title>
     Cross-Agent Privilege Escalation: When Agents Free Each Other &middot;  Embrace The Red
  </title>

  <link rel="stylesheet" href="https://embracethered.com/blog/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/main.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/github.css" />
  
  <link rel="stylesheet" href="https://embracethered.com/blog/fonts/cachedfonts.css" type="text/css">
  <link rel="shortcut icon" type="image/x-icon" href="https://embracethered.com/blog/images/favicon.ico" />
  <link rel="apple-touch-icon" type="image/x-icon" href="https://embracethered.com/blog/images/favicon.ico" />
  

  
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@wunderwuzzi23">
<meta name="twitter:title" content="Cross-Agent Privilege Escalation: When Agents Free Each Other">
<meta name="twitter:description" content="Cross-Agent Privilege Escalation: When Agents Free Each Other">
<meta name="twitter:image" content="https://embracethered.com/blog/images/2025/agents-free-each-other.png">

<meta name="twitter:creator" content="@wunderwuzzi23">



  
</head>
<body>
    <header class="global-header"  style="background-image:url( /blog/images/bg.png )">
    <section class="header-text">
      <h1><a href="https://embracethered.com/blog/">Embrace The Red</a></h1>
      
      <div class="tag-line" style="min-width:fit-content; font-weight: 400;">
        wunderwuzzi&#39;s blog
        <br><div style="color: greenyellow; font-weight:400;">learn the hacks, stop the attacks.</div> 
      </div>
      
      <div class="sns-links hidden-print">
  
  <a href="mailto:security@wunderwuzzi.net">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  <a href="https://twitter.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  
  <a href="https://github.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
  
  <a href="https://youtube.com/@embracethered" target="_blank">
    <i class="fa fa-youtube"></i>
  </a>
  
  
  
  <a href="/blog/index.xml" target="_blank">
    <i class="fa fa-rss"></i>
  </a>
</div>

      
      <a href="https://embracethered.com/blog/" class="btn-header btn-back hidden-xs">
        <i class="fa fa-angle-left" aria-hidden="true"></i>
        &nbsp;Home
      </a>
      
    
      <a href="/blog/index.xml" class="btn-header btn-subscribe hidden-xs">
        <i class="fa fa-rss" aria-hidden="true"></i>
        &nbsp;Subscribe
      </a>
    </section>
  </header>
  <main class="container">


<article>
  <header>
    <h1 class="text-primary">Cross-Agent Privilege Escalation: When Agents Free Each Other</h1>
    <div class="post-meta clearfix">
    
      <div class="post-date pull-left">
        Posted on
        <time datetime="2025-09-24T12:20:58-07:00">
          Sep 24, 2025
        </time>
      </div>
    
      <div class="pull-right">
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/llm">#llm</a></span>
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/agents">#agents</a></span>
        
      </div>
    </div>
  </header>
  <section>
    
<a id="top_ref"></a>

<p>During the <a href="https://monthofaibugs.com">Month of AI Bugs</a>, I described an emerging vulnerability pattern that shows how commonly agentic systems have a design flaw that allows an agent to overwrite its own configuration and security settings.</p>
<p>This allows the agent to break out of its sandbox and escape by executing arbitrary code.</p>
<p>My research with <a href="/blog/posts/2025/github-copilot-remote-code-execution-via-prompt-injection/">GitHub Copilot</a>, <a href="/blog/posts/2025/aws-kiro-aribtrary-command-execution-with-indirect-prompt-injection/">AWS Kiro</a> and a few others demonstrated how this can be exploited by an adversary with an indirect prompt injection.</p>
<p>This post goes a step further by showing how one compromised agent can rewrite another agent&rsquo;s config and &lsquo;free&rsquo; it, creating a cross-agent escalation loop. &lsquo;Freeing&rsquo; in this context means that one agent helps another to break out of its sandbox by giving it additional capabilities.</p>
<p><a href="/blog/images/2025/agents-free-each-other.png"><img src="/blog/images/2025/agents-free-each-other.png" alt="agents that free each other"></a></p>
<h2 id="agents-that-write-to-other-agents-configuration">Agents That Write to Other Agents&rsquo; Configuration</h2>
<p>The concept is rather simple. Many developers use multiple coding agents on the same codebase. This is to get a second opinion, compare results, or have one agent review code another agent created.</p>
<p>As an example, let&rsquo;s say you use both GitHub Copilot and Claude Code on the same codebase.</p>
<p><strong>A few things to know upfront:</strong></p>
<ul>
<li>A coding agent can achieve arbitrary code execution via multiple means: allowlisting commands, adding/modifying MCP server configuration settings on the fly, adding tasks to the VS Code project (via <code>.vscode/tasks.json</code>) and similar. If the attack is performed by a third-party attacker via indirect prompt injection it basically Remote Code Execution.</li>
<li>GitHub Copilot stores a lot of its settings in <code>.vscode/settings.json</code>, and there is also a <code>.vscode/mcp.json</code> file to configure MCP servers.</li>
<li>Claude Code stores local MCP configuration settings in <code>.mcp.json</code>.</li>
<li>Most agents act on and can be strongly influenced by writing instructions to <code>AGENTS.md</code>, or <code>.vscode/copilot-instructions.md</code> and similar.</li>
<li>Many agents write to files without the user&rsquo;s permission.</li>
</ul>
<p>After some of my disclosures, vendors started adding mitigations to not have the agent overwrite configuration settings without the user&rsquo;s permission. However, this still means the agent can write/create other files and folders.</p>
<p>Now that weâ€™ve walked through some of the background information, let&rsquo;s explore how Copilot can &ldquo;free&rdquo; Claude Code!</p>
<h2 id="overwriting-other-agents-configuration-settings">Overwriting Other Agents&rsquo; Configuration Settings</h2>
<p>GitHub Copilot can create/write to the configuration and instructions files of other agents.</p>
<p>For instance, it&rsquo;s still possible to create and write to files, such as <code>.gemini/settings.json</code>, <code>.claude/settings.local.json</code>, and <code>~/.mcp.json</code> (Claude&rsquo;s MCP configuration) to execute arbitrary code or allowlist shell commands for other agents</p>
<p>It&rsquo;s also possible to write to files like <code>CLAUDE.md</code> or <code>AGENTS.md</code>, etc..</p>
<p>So, I think you understand now where this is going.</p>
<p><strong>This can be leveraged to have agents &ldquo;free&rdquo; each other.</strong></p>
<ol>
<li>An indirect prompt injection hijacks Copilot and makes it write to Claude&rsquo;s MCP config to add a malicious server; it can also update the custom agent instructions for Claude to take specific agents (e.g. <code>CLAUDE.md</code>)</li>
<li>When the developer uses Claude Code the configuration changes that Copilot made are picked up and it will run arbitrary code</li>
<li>Optional: In turn, Claude can now write to Copilot&rsquo;s configuration also and return the favor</li>
</ol>
<p>This attack chain demonstrates a significant design flaw, indicating that today&rsquo;s agentic systems are already accumulating substantial security debt.</p>
<p><a href="/blog/images/2025/agent-free-design.png"><img src="/blog/images/2025/agent-free-design.png" alt="agents free architecture design"></a></p>
<p>Agents that coordinate and collaborate to achieve malicious objectives seem very plausible to me in the long term, and it will be very difficult to mitigate unless systems are designed with secure defaults.</p>
<h2 id="video-walkthrough">Video Walkthrough</h2>
<p>Here is a video that explains the scenario in detail and it includes a demo:</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/EWuoWjWO8i4" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<h2 id="mitigations-and-recommendations">Mitigations and Recommendations</h2>
<p>There are a couple of secure defaults that vendors need to consider, and a few things users should be aware of:</p>
<ul>
<li>Isolate your agent&rsquo;s configuration to make it less accessible to others</li>
<li>Do not automatically overwrite or create files, but propose changes first; at least consider not writing to any dot files or folders without user&rsquo;s approval (that seems the most practical approach currently)</li>
<li>Beware that if you use multiple agents on the same data/code or infrastructure they might interfere with each other</li>
<li>Indirect prompt injection can exploit such behavior - so be careful with untrusted data!</li>
<li>Consider least privilege execution for agents</li>
</ul>
<h2 id="responsible-disclosure">Responsible Disclosure</h2>
<p>It&rsquo;s important to highlight that this exploit chain is not limited to VS Code and GitHub Copilot, but is a generic novel approach that demonstrates how exploitation of one agent can lead to the compromise of another agent. Which, then, in turn reconfigures the first (or other) agent(s), allowing them to run arbitrary code or modify their instruction settings.</p>
<p>Nevertheless, I reported this specific demo to MSRC, but it was not considered severe enough to require immediate security servicing. However, the team might look into improving mitigations.</p>
<h2 id="conclusion">Conclusion</h2>
<p>The ability for agents to write to each other&rsquo;s settings and configuration files opens up a fascinating, and concerning, novel category of exploit chains.</p>
<p>What starts as a single indirect prompt injection can quickly escalate into a multi-agent compromise, where one agent &ldquo;frees&rdquo; another agent and sets up a loop of escalating privilege and control.</p>
<p>This isn&rsquo;t theoretical. With current tools and defaults, it&rsquo;s very possible today and not well mitigated across the board.</p>
<p>More broadly, this highlights the need for better isolation strategies and stronger secure defaults in agent tooling. We&rsquo;re moving toward scenarios where multiple agents operate in the same environments, sometimes on the same data and infrastructure. If we don&rsquo;t consider the possibility of agents collaborating, intentionally or not, we&rsquo;re going to see more of these cross-agent attack chains emerge.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://monthofaibugs.com">Month of AI Bugs</a></li>
<li><a href="/blog/posts/2025/github-copilot-remote-code-execution-via-prompt-injection/">GitHub Copilot - Remote Code Execution via Indirect Prompt Injection (CVE-2025-53773)</a></li>
<li><a href="/blog/posts/2025/aws-kiro-aribtrary-command-execution-with-indirect-prompt-injection/">AWS Kiro - Remote Code Execution via Indirect Prompt Injection (No CVE issued by Amazon)</a></li>
</ul>

  </section>
  <footer>
    
    
    
    <footer></footer><hr/>
    
    <ul class="pager">
      
      <li class="next disabled"><a href="#">Newer <span aria-hidden="true">&rarr;</span></a></li>
      
      
      <li class="author-contact">
        <a href="mailto:security@wunderwuzzi.net">
          <i class="fa fa-envelope-o" aria-hidden="true"></i>
          &nbsp;Contact me
        </a>
     </li>

      
      
      <li class="previous"><a href="https://embracethered.com/blog/posts/2025/wrapping-up-month-of-ai-bugs/"><span aria-hidden="true">&larr;</span> Older</a></li>
      
    </ul>
  </footer>
</article>
</main>
  <footer class="container global-footer">
    <div class="copyright-note pull-left">
     
     (c) WUNDERWUZZI 2018-2025
     <div class="sns-links hidden-print">
  
  <a href="mailto:security@wunderwuzzi.net">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  <a href="https://twitter.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  
  <a href="https://github.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
  
  <a href="https://youtube.com/@embracethered" target="_blank">
    <i class="fa fa-youtube"></i>
  </a>
  
  
  
  <a href="/blog/index.xml" target="_blank">
    <i class="fa fa-rss"></i>
  </a>
</div>
 
     <div style="font-size:small;font-style: italic;color:crimson">
    Disclaimer: Penetration testing requires authorization from proper stakeholders. Information on this blog is provided for research and educational purposes to advance understanding of attacks and countermeasures to help secure the Internet. 
    </div>
    </div>
</footer>
  <script src="https://embracethered.com/blog/js/highlight.pack.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  
  



<script type="text/javascript">
  var _paq = window._paq || [];
  _paq.push(["disableCookies"]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//wuzzi.net/anamato/inc/";
    _paq.push(['setTrackerUrl', u+'rts.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'rts.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<img src="https://wuzzi.net/anamato/inc/rts.php?idsite=1&amp;rec=1" style="border:0;" alt="" />
  
</body>
</html>

