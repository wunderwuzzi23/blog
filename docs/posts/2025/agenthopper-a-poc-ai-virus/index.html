<!DOCTYPE html>
<html lang="en-us">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <meta property="og:title" content=" AgentHopper: An AI Virus (Research Project) &middot;  Embrace The Red" />
  
  <meta property="og:site_name" content="Embrace The Red" />
  <meta property="og:url" content="https://embracethered.com/blog/posts/2025/agenthopper-a-poc-ai-virus/" />
  
  
  <meta property="og:type" content="article" />
  
  <meta property="og:article:published_time" content="2025-08-29T20:20:58-07:00" />
  
  <meta property="og:article:tag" content="llm" />
  
  <meta property="og:article:tag" content="agents" />
  
  <meta property="og:article:tag" content="month of ai bugs" />
  
  

  <title>
     AgentHopper: An AI Virus (Research Project) &middot;  Embrace The Red
  </title>

  <link rel="stylesheet" href="https://embracethered.com/blog/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/main.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/github.css" />
  
  <link rel="stylesheet" href="https://embracethered.com/blog/fonts/cachedfonts.css" type="text/css">
  <link rel="shortcut icon" type="image/x-icon" href="https://embracethered.com/blog/images/favicon.ico" />
  <link rel="apple-touch-icon" type="image/x-icon" href="https://embracethered.com/blog/images/favicon.ico" />
  

  
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@wunderwuzzi23">
<meta name="twitter:title" content="AgentHopper: An AI Virus Research Project">
<meta name="twitter:description" content="AgentHopper: A proof-of-concept AI Virus">
<meta name="twitter:image" content="https://embracethered.com/blog/images/2025/episode29-yt.png">

<meta name="twitter:creator" content="@wunderwuzzi23">



  
</head>
<body>
    <header class="global-header"  style="background-image:url( /blog/images/bg.png )">
    <section class="header-text">
      <h1><a href="https://embracethered.com/blog/">Embrace The Red</a></h1>
      
      <div class="tag-line" style="min-width:fit-content; font-weight: 400;">
        wunderwuzzi&#39;s blog
        <br><div style="color: greenyellow; font-weight:400;">learn the hacks, stop the attacks.</div> 
      </div>
      
      <div class="sns-links hidden-print">
  
  <a href="mailto:security@wunderwuzzi.net">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  <a href="https://twitter.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  
  <a href="https://github.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
  
  <a href="https://youtube.com/@embracethered" target="_blank">
    <i class="fa fa-youtube"></i>
  </a>
  
  
  
  <a href="/blog/index.xml" target="_blank">
    <i class="fa fa-rss"></i>
  </a>
</div>

      
      <a href="https://embracethered.com/blog/" class="btn-header btn-back hidden-xs">
        <i class="fa fa-angle-left" aria-hidden="true"></i>
        &nbsp;Home
      </a>
      
    
      <a href="/blog/index.xml" class="btn-header btn-subscribe hidden-xs">
        <i class="fa fa-rss" aria-hidden="true"></i>
        &nbsp;Subscribe
      </a>
    </section>
  </header>
  <main class="container">


<article>
  <header>
    <h1 class="text-primary">AgentHopper: An AI Virus (Research Project)</h1>
    <div class="post-meta clearfix">
    
      <div class="post-date pull-left">
        Posted on
        <time datetime="2025-08-29T20:20:58-07:00">
          Aug 29, 2025
        </time>
      </div>
    
      <div class="pull-right">
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/llm">#llm</a></span>
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/agents">#agents</a></span>
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/month-of-ai-bugs">#month of ai bugs</a></span>
        
      </div>
    </div>
  </header>
  <section>
    
<a id="top_ref"></a>

<p>As part of the Month of AI Bugs, serious vulnerabilities that allow remote code execution via indirect prompt injection were discovered. There was a period of a few weeks where multiple arbitrary code execution vulnerabilities existed in popular agents, like GitHub Copilot, Amazon Q, AWS Kiro,&hellip;</p>
<p>During that time I was wondering if it would be possible to write an AI virus.</p>
<p><a href="/blog/images/2025/agenthopper-logo.png"><img src="/blog/images/2025/agenthopper-logo.png" alt="AgentHopper Logo"></a></p>
<p>Hence the idea of AgentHopper was born.</p>
<p><strong>All vulnerabilities mentioned in this research were responsibly disclosed and have been patched by the respective vendors. This post is shared for educational and awareness purposes to help improve security in AI-based products. Hopefully this research also serves as a warning to vendors of AI products that AI security vulnerabilities and the downstream implications of prompt injection can have significant consequences if not mitigated. Check out the mitigations section for useful tips as well.</strong></p>
<p>Interestingly, recently we have seen <a href="https://github.com/aws/aws-toolkit-vscode/security/advisories/GHSA-7g7f-ff96-5gcw">multiple real-world cases</a> where adversaries <a href="https://www.stepsecurity.io/blog/supply-chain-security-alert-popular-nx-build-system-package-compromised-with-data-stealing-malware">target and exploit coding agents</a>, including pushing information up to GitHub.</p>
<h2 id="agenthopper---an-ai-virus-research-project">AgentHopper - An AI Virus Research Project</h2>
<p>The idea was to have one prompt injection payload that would operate across agents and exploit them accordingly. This was to demonstrate that conditional prompt injection can be leveraged as a powerful mechanism to target specific agents.</p>
<h3 id="video-walkthrough">Video Walkthrough</h3>
<p>If you prefer a video that explains the details, you can watch it here:

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/vlF0sblunQY" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>
</p>
<h2 id="the-vulnerabilities-and-the-proof-of-concept">The Vulnerabilities and the Proof-of-concept</h2>
<p>Let&rsquo;s first briefly revisit the vulnerabilities that vendors fixed which enabled AgentHopper.</p>
<p>During the Month of AI Bugs we described a couple of arbitrary code execution vulnerabilities that vendors addressed:</p>
<ul>
<li><a href="/blog/posts/2025/github-copilot-remote-code-execution-via-prompt-injection/">GitHub Copilot: Remote Code Execution via Prompt Injection (CVE-2025-53773)</a></li>
<li><a href="/blog/posts/2025/amp-agents-that-modify-system-configuration-and-escape/">Amp Code: Arbitrary Command Execution via Prompt Injection Fixed</a></li>
<li><a href="/blog/posts/2025/amazon-q-developer-remote-code-execution/">Amazon Q Developer: Remote Code Execution with Prompt Injection</a></li>
<li><a href="/blog/posts/2025/aws-kiro-aribtrary-command-execution-with-indirect-prompt-injection/">AWS Kiro: Arbitrary Code Execution via Indirect Prompt Injection</a></li>
</ul>
<p>When discovering and responsibly disclosing them to vendors, I was wondering if it would be possible to build a prompt injection payload that exploits them all.</p>
<p>A payload that can propagate, like a good old fashion computer virus.</p>
<p>Back when I had a Commodore Amiga, viruses actually got transferred via floppy disks. When inserting an infected floppy disk, the virus would move to memory and wait for any new floppy disk to be inserted. If a new floppy was inserted, then the virus would attach itself to that floppy, and so on.</p>
<p>All vulnerabilities have been addressed by vendors by the way.</p>
<h2 id="the-infection-model-how-agenthopper-spreads">The Infection Model: How AgentHopper Spreads</h2>
<p>So, how does this thing actually move? The basic concept for AgentHopper&rsquo;s propagation is deceptively simple and leverages common developer workflows.</p>
<p>This diagram is sort of a high level architectural overview:
<a href="/blog/images/2025/agenthopper-concept.png"><img src="/blog/images/2025/agenthopper-concept.png" alt="AgentHopper - Concept"></a></p>
<p>Here&rsquo;s the breakdown:</p>
<ul>
<li>
<p><strong>Initial Infection</strong>: An adversary compromises a developer&rsquo;s agent (Agent 1) through an initial indirect prompt injection or otherwise. This is the entry point.</p>
</li>
<li>
<p><strong>Payload Distribution</strong>: Once Agent 1 is compromised, it downloads the AgentHopper binary and executes it. AgentHopper then scans for Git repositories (e.g., Repo 1, Repo 2), injects them with the universal prompt injection payload, commits, and pushes the changes back to GitHub. The virus basically finds new repositories, which serve as host.</p>
</li>
<li>
<p><strong>The Hop</strong>: Now, imagine another developer, using another coding agent (Agent 2), pulls the now-infected code from GitHub (say, from Repo 2). When Agent 2 processes or interacts with this code, the prompt injection is triggered.</p>
</li>
<li>
<p><strong>Secondary Infection &amp; Propagation</strong>: Agent 2 becomes compromised, downloads and executes AgentHopper, and the cycle continues, infecting its own repositories (Repo 2, Repo 3) and pushing those changes.</p>
</li>
</ul>
<p>This mechanism highlights how easily the well-crafted prompt was able to propagate across different systems and agents.</p>
<p><a href="/blog/images/2025/agenthopper-1-hop.png"><img src="/blog/images/2025/agenthopper-1-hop.png" alt="AgentHopper Logo"></a></p>
<p>After a successful infection, the target source code would look like this:</p>
<p><a href="/blog/images/2025/agenthopper-after.png"><img src="/blog/images/2025/agenthopper-after.png" alt="Virus Payload"></a></p>
<p>As you can see it inserted the prompt at the beginning of the file.</p>
<p><strong>Safety Switch:</strong> To avoid accidents and to make sure it doesn&rsquo;t write to repos in my environment that I didn&rsquo;t want to, I added a safety switch that asks for approval for each repo.</p>
<h2 id="what-are-conditional-prompt-injections">What are Conditional Prompt Injections?</h2>
<p>I first <a href="blog/posts/2024/whoami-conditional-prompt-injection-instructions/">described the idea of conditional instructions</a> for prompt injection exploit development a bit over a year ago with Microsoft Copilot, where we sent phishing emails that targeted different users with different attack payloads.</p>
<p>The idea is that we leverage information from the system prompt (like a user&rsquo;s name, job title) to branch off with conditional instructions targeted specifically for that individual.</p>
<p><a href="/blog/images/2025/agenthopper-conditional-pi.png"><img src="/blog/images/2025/agenthopper-conditional-pi.png" alt="Conditional Prompt Injection - AgentHopper"></a></p>
<p>AgentHopper works similarly. To demonstrate that a prompt injection payload can be universal, and target different coding agents with different exploits to achieve arbitrary code execution.</p>
<h2 id="attack-paths-and-exploits">Attack Paths and Exploits</h2>
<p>All of these vulnerabilities have now been patched.</p>
<ol>
<li><strong>GitHub Copilot:</strong> Write to the agents the <code>settings.json</code> file to put Copilot into YOLO mode, then download and run AgentHopper</li>
<li><strong>Amp Code:</strong> Write to the agent&rsquo;s configuration file and add a fake MCP server which is a python program that downloads AgentHopper and runs it</li>
<li><strong>Amazon Q Developer:</strong> Execute the <code>find</code> bash command with the <code>-exec</code> argument to download AgentHopper and execute it</li>
<li><strong>AWS Kiro:</strong> Write to the agent&rsquo;s configuration file to allowlist all bash commands, then download and run AgentHopper</li>
</ol>
<h2 id="agents-that-can-modify-their-own-configuration">Agents That Can Modify Their Own Configuration</h2>
<p>As I described when I first discovered these vulnerabilities where an agent can modify its own configuration to escape, it sounded like science fiction, but it turns out it&rsquo;s actually a common design flaw that can easily be mitigated and even be caught early on during threat modeling.</p>
<h2 id="mitigations--recommendations-for-developers">Mitigations &amp; Recommendations For Developers!</h2>
<p>When developing this, it gave me a bit the chills, because it was seemingly quite easy to vibe code such malware. Scary simple.</p>
<p>But it also highlights a couple of things that are important for user/developer to consider, because we can protect ourselves from such attacks:</p>
<ul>
<li>Make sure you <strong>have a passphrase</strong> on your SSH and signing keys!</li>
<li><strong>Enable branch protection</strong></li>
<li><strong>Principle of Least Privilege</strong>: This demo exploited vulnerabilities which all have been patched by vendors. However users might configure agents in a way that gives them too many privileges (e.g. allowlisting dangerous commands etc.), or running agents entirely in YOLO mode.</li>
<li>If a coding agent has <strong>sandbox capabilities</strong>, then leverage them</li>
<li>EDR vendors and GitHub hopefully considers such threats, as they can detect widespread infections quickly and mitigate it</li>
<li><strong>Vendors of coding agents need to make sure to have secure defaults, so that when an agent is hijacked via indirect prompt injection the harm it can cause is limited</strong></li>
<li><strong>Vendors need to perform in-depth threat modeling.</strong> That can identify issues such as the requirement to isolate configuration settings from the agent (and also other agents) early on.</li>
</ul>
<p><strong>It would be best if vendors would publicly share the outcome of threat modeling to highlight exactly what is done to mitigate the implications of prompt injection.</strong></p>
<h2 id="conclusion">Conclusion</h2>
<p>Given the <a href="https://www.stepsecurity.io/blog/supply-chain-security-alert-popular-nx-build-system-package-compromised-with-data-stealing-malware">recent malware cases</a>  and <a href="https://github.com/aws/aws-toolkit-vscode/security/advisories/GHSA-7g7f-ff96-5gcw">exploits leveraging coding agents</a>, AI-driven malware and prompt payloads will likely become more prevalent in the near future.</p>
<p>AgentHopper is a good reminder to make sure you have branch protection on, and that you use a passphrase on your ssh and signing keys to prevent malware automatically pushing changes to GitHub, or other places.</p>
<h2 id="thank-you">Thank you.</h2>
<p>This is the last post of the Month of AI Bugs.</p>
<p>If you read many of my posts I want to thank you very much. I really do hope that my work can inspire more people to get into security testing, especially now with the rapid advent of AI and agents, we need a lot more people to hold vendors accountable and ask basic questions around the rapid and wide deployment of AI systems that have fundamental design weaknesses.</p>
<p>With that said, my posting schedule will go back to a less frequent cadence.</p>
<p>Wish you all well, and happy hacking!</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://monthofaibugs.com">Month of AI Bugs 2025</a></li>
<li><a href="https://github.com/aws/aws-toolkit-vscode/security/advisories/GHSA-7g7f-ff96-5gcw">Amazon Q - Malicious script injected into Amazon Q Developer for VS Code Extension</a></li>
<li><a href="https://www.stepsecurity.io/blog/supply-chain-security-alert-popular-nx-build-system-package-compromised-with-data-stealing-malware%5D">Step Security - Supply chain alert in popular nx build system package</a></li>
</ul>

  </section>
  <footer>
    
    
    
    <footer></footer><hr/>
    
    <ul class="pager">
      
      <li class="next disabled"><a href="#">Newer <span aria-hidden="true">&rarr;</span></a></li>
      
      
      <li class="author-contact">
        <a href="mailto:security@wunderwuzzi.net">
          <i class="fa fa-envelope-o" aria-hidden="true"></i>
          &nbsp;Contact me
        </a>
     </li>

      
      
      <li class="previous"><a href="https://embracethered.com/blog/posts/2025/windsurf-dangers-lack-of-security-controls-for-mcp-server-tool-invocation/"><span aria-hidden="true">&larr;</span> Older</a></li>
      
    </ul>
  </footer>
</article>
</main>
  <footer class="container global-footer">
    <div class="copyright-note pull-left">
     
     (c) WUNDERWUZZI 2018-2025
     <div class="sns-links hidden-print">
  
  <a href="mailto:security@wunderwuzzi.net">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  <a href="https://twitter.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  
  <a href="https://github.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
  
  <a href="https://youtube.com/@embracethered" target="_blank">
    <i class="fa fa-youtube"></i>
  </a>
  
  
  
  <a href="/blog/index.xml" target="_blank">
    <i class="fa fa-rss"></i>
  </a>
</div>
 
     <div style="font-size:small;font-style: italic;color:crimson">
    Disclaimer: Penetration testing requires authorization from proper stakeholders. Information on this blog is provided for research and educational purposes to advance understanding of attacks and countermeasures to help secure the Internet. 
    </div>
    </div>
</footer>
  <script src="https://embracethered.com/blog/js/highlight.pack.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  
  



<script type="text/javascript">
  var _paq = window._paq || [];
  _paq.push(["disableCookies"]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//wuzzi.net/anamato/inc/";
    _paq.push(['setTrackerUrl', u+'rts.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'rts.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<img src="https://wuzzi.net/anamato/inc/rts.php?idsite=1&amp;rec=1" style="border:0;" alt="" />
  
</body>
</html>

